# リアルタイム音声文字起こし - Chrome拡張機能

このChrome拡張機能は、Webブラウザのタブで再生されている音声（YouTube、Zoom、オンライン会議など）をリアルタイムで文字起こしします。

## 主な機能

- **タブ音声キャプチャ**: chrome.tabCapture APIを使用して、現在のタブの音声を自動的にキャプチャ
- **リアルタイム文字起こし**: faster-whisperによる高精度な日本語音声認識
- **ひらがな正規化**: 文字起こし結果をひらがなに変換（オプション）
- **翻訳**: 日本語→英語の自動翻訳（オプション）
- **テキストファイル出力**: タイムスタンプ付きでテキストファイルとしてダウンロード可能
- **サイドパネル表示**: Chrome右側のサイドパネルに常時表示

## インストール方法

### 前提条件

このChrome拡張機能を使用するには、別途APIサーバーが必要です。

1. **APIサーバーを起動**:
   ```bash
   cd /path/to/voice-analyzer-api
   docker compose up -d
   ```

2. **サーバーが正常に起動していることを確認**:
   ```bash
   docker compose ps
   ```

### Chrome拡張機能のインストール

1. **拡張機能をChromeに読み込む**:
   - Chromeブラウザで `chrome://extensions/` を開く
   - 右上の「デベロッパーモード」を有効化
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - `voice-analyzer-api/extension` フォルダを選択

2. **拡張機能が読み込まれたことを確認**:
   - 拡張機能一覧に「リアルタイム音声文字起こし」が表示される
   - アイコンがツールバーに表示される

## 使い方

### 1. 設定（初回のみ）

1. 拡張機能の設定画面を開く:
   - 拡張機能一覧で「リアルタイム音声文字起こし」の「詳細」をクリック
   - 「拡張機能のオプション」をクリック

2. **APIサーバーURL**を入力:
   - デフォルト: `ws://localhost:5001`
   - リモートサーバーの場合は、そのURLに変更

3. **デフォルト処理オプション**を設定:
   - ひらがな正規化: デフォルトで有効化するか
   - 翻訳（日→英）: デフォルトで有効化するか

4. 「保存」をクリック

### 2. 文字起こしの実行

1. **文字起こししたいWebページを開く**:
   - YouTube動画、Zoom会議、オンライン授業など、音声が再生されるページ

2. **サイドパネルを開く**:
   - Chromeツールバーの拡張機能アイコンをクリック
   - サイドパネルが右側に表示される

3. **処理オプションを選択**:
   - ひらがな正規化: チェックを入れると、文字起こし結果をひらがなに変換
   - 翻訳（日→英）: チェックを入れると、日本語を英語に翻訳

4. **「開始」ボタンをクリック**:
   - タブ音声のキャプチャが自動的に開始される
   - 音声が文字起こしされ、リアルタイムで表示される

5. **「停止」ボタンをクリック**:
   - 文字起こしを終了

6. **「ダウンロード」ボタンをクリック**:
   - テキストファイル（`transcript_YYYYMMDD_HHMMSS.txt`）をダウンロード

## UI概要

```
┌─────────────────────────────┐
│ 🎤 音声文字起こし            │
│ このタブの音声をリアルタイム認識 │
├─────────────────────────────┤
│ 処理オプション               │
│ ☑ ひらがな正規化             │
│ □ 翻訳（日→英）             │
├─────────────────────────────┤
│ [開始] [停止]               │
│ [ダウンロード]              │
│ 準備完了                     │
├─────────────────────────────┤
│ 音量: ████░░░░ (50%)        │
├─────────────────────────────┤
│ 文字起こし結果               │
│ ┌─ 確定テキスト ───────────┐│
│ │ これはサンプルテキストです │ │
│ └──────────────────────────┘│
│ ┌─ 暫定テキスト ───────────┐│
│ │ しょり                    │ │
│ └──────────────────────────┘│
└─────────────────────────────┘
```

## トラブルシューティング

### サーバー接続エラー

**症状**: 「サーバーに接続できませんでした」エラーが表示される

**対処法**:
1. APIサーバーが起動しているか確認:
   ```bash
   docker compose ps
   ```
2. サーバーのURLが正しいか確認（設定画面で確認）
3. ファイアウォールやセキュリティソフトがWebSocket接続をブロックしていないか確認

### 音声トラックが見つかりません

**症状**: 「音声トラックが見つかりません」エラーが表示される

**対処法**:
1. タブで音声が再生されているか確認
2. タブのミュートが解除されているか確認
3. 他のアプリケーションが音声デバイスを占有していないか確認

### 文字起こしが始まらない

**対処法**:
1. ブラウザのコンソールでエラーを確認（F12キーを押してDeveloper Toolsを開く）
2. 拡張機能をリロード（`chrome://extensions/`で「リロード」ボタンをクリック）
3. Chromeブラウザを再起動

## 技術仕様

### 使用API

- **chrome.tabCapture**: タブ音声のキャプチャ
- **chrome.sidePanel**: サイドパネル表示
- **chrome.storage.sync**: 設定の同期保存
- **Web Audio API**: 音声処理
- **AudioWorklet**: 音声チャンク生成
- **WebSocket**: サーバーとの通信

### 音声処理

- **サンプルレート**: 16kHz
- **チャンネル**: モノラル
- **ビット深度**: 16-bit PCM
- **チャンクサイズ**: 3秒

### 対応ブラウザ

- Google Chrome（バージョン 116以降推奨）
- Chromiumベースのブラウザ（Edge、Braveなど）

## 制約事項

- **Chrome専用**: Safari、Firefoxでは動作しません
- **APIサーバー必須**: ローカルまたはリモートでサーバー起動が必要
- **現在のタブのみ**: 複数タブの同時録音は不可
- **HTTPS推奨**: 本番環境ではHTTPS接続を推奨

## ライセンス

このプロジェクトは、親プロジェクト（voice-analyzer-api）のライセンスに従います。

## 貢献

バグ報告や機能リクエストは、GitHubのIssueセクションにお願いします。

## サポート

問題が発生した場合は、以下を確認してください:
1. APIサーバーが正常に起動しているか
2. Chromeブラウザが最新版か
3. 拡張機能の設定が正しいか

詳細なドキュメントは、親プロジェクトの`docs/`フォルダを参照してください。
